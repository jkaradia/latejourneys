<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<title>jQuery UI Accordion - Default functionality</title>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.10.1.js"
	type="text/javascript"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"
	type="text/javascript"></script>
<link rel="stylesheet" href="/resources/demos/style.css" />
<script type="text/javascript">
	var journeys = [ {
		"id" : "1",
		"card" : "132312312",
		"from" : "Aldgate",
		"to" : "Amersham",
		"start" : "10:34 01/01/2031",
		"end" : "10:35 01/01/2021",
		"expected" : "10",
		"actual" : "100",
		"claim" : "1"
	}, {
		"id" : "5",
		"card" : "132312312",
		"from" : "Chesham",
		"to" : "Watford",
		"start" : "10:34 01/01/2031",
		"end" : "10:35 01/01/2021",
		"expected" : "10",
		"actual" : "100",
		"claim" : "1"
	}, {
		"id" : "2",
		"card" : "132312312",
		"from" : "Aldgate",
		"to" : "Watford",
		"start" : "10:34 01/01/2031",
		"end" : "10:35 01/01/2021",
		"expected" : "10",
		"actual" : "100",
		"claim" : "0"
	}, {
		"id" : "4",
		"card" : "132312312",
		"from" : "Old Street",
		"to" : "Amersham",
		"start" : "10:34 01/01/2031",
		"end" : "10:35 01/01/2021",
		"expected" : "10",
		"actual" : "100",
		"claim" : "0"
	}, {
		"id" : "3",
		"card" : "132312312",
		"from" : "Aldgate",
		"to" : "Rayners Lane",
		"start" : "10:34 01/01/2031",
		"end" : "10:35 01/01/2021",
		"expected" : "10",
		"actual" : "100",
		"claim" : "1"
	}, ];

	function display() {
		$.each(journeys, function(index, value) {
			console.log(this);
			var journeyHtml = [ "<h3>" ];
			journeyHtml.push(this.from);
			journeyHtml.push(" To ");
			journeyHtml.push(this.to);
			journeyHtml.push("  (");
			journeyHtml.push(this.start);
			journeyHtml.push(")");
			journeyHtml.push("</h3>");
			journeyHtml.push("<div>");
			journeyHtml.push("<p>");
			journeyHtml.push("<table>");
			journeyHtml.push("<tr>");
			journeyHtml.push("<td>");
			journeyHtml.push("Card");
			journeyHtml.push("</td>");
			journeyHtml.push("<td>");
			journeyHtml.push(this.card);
			journeyHtml.push("</td>");
			journeyHtml.push("</tr>");
			journeyHtml.push("<tr>");
			journeyHtml.push("<td>");
			journeyHtml.push("Expected");
			journeyHtml.push("</td>");
			journeyHtml.push("<td>");
			journeyHtml.push(this.expected);
			journeyHtml.push("</td>");
			journeyHtml.push("</tr>");
			journeyHtml.push("<tr>");
			journeyHtml.push("<td>");
			journeyHtml.push("Actual");
			journeyHtml.push("</td>");
			journeyHtml.push("<td>");
			journeyHtml.push(this.actual);
			journeyHtml.push("</td>");
			journeyHtml.push("</tr>");
			journeyHtml.push("</table>");
			if (this.claim == "1") {
				journeyHtml.push("<tr>");
				journeyHtml.push("<td colspan='2'>");
				journeyHtml.push("<button ");
				journeyHtml.push("class='claim' ");
				journeyHtml.push("name='");
				journeyHtml.push(this.id);
				journeyHtml.push("'>");
				journeyHtml.push("Claim");
				journeyHtml.push("</button>");
				journeyHtml.push("</td>");
				journeyHtml.push("</tr>");
			}
			journeyHtml.push("</p>");
			journeyHtml.push("</div>");

			console.log(journeyHtml.join(""));
			$("#accordion").append(journeyHtml.join(""));
			$("#accordion").accordion("refresh");

		});
	}
	
	function getJourneys() {
	
	$.getJSON( '/journey.json', function( data ) {
		
		  $.each( data.journeys, function( item) {
				var journeyHtml = [ "<h3>" ];
				journeyHtml.push(this.from);
				journeyHtml.push(" To ");
				journeyHtml.push(this.to);
				journeyHtml.push("  (");
				journeyHtml.push(this.start);
				journeyHtml.push(")");
				journeyHtml.push("</h3>");
				journeyHtml.push("<div>");
				journeyHtml.push("<p>");
				journeyHtml.push("<table>");
				journeyHtml.push("<tr>");
				journeyHtml.push("<td>");
				journeyHtml.push("Card");
				journeyHtml.push("</td>");
				journeyHtml.push("<td>");
				journeyHtml.push(this.card);
				journeyHtml.push("</td>");
				journeyHtml.push("</tr>");
				journeyHtml.push("<tr>");
				journeyHtml.push("<td>");
				journeyHtml.push("Expected");
				journeyHtml.push("</td>");
				journeyHtml.push("<td>");
				journeyHtml.push(this.expected);
				journeyHtml.push("</td>");
				journeyHtml.push("</tr>");
				journeyHtml.push("<tr>");
				journeyHtml.push("<td>");
				journeyHtml.push("Actual");
				journeyHtml.push("</td>");
				journeyHtml.push("<td>");
				journeyHtml.push(this.actual);
				journeyHtml.push("</td>");
				journeyHtml.push("</tr>");
				journeyHtml.push("</table>");
				if (this.claim == "1") {
					journeyHtml.push("<tr>");
					journeyHtml.push("<td colspan='2'>");
					journeyHtml.push("<button ");
					journeyHtml.push("class='claim' ");
					journeyHtml.push("name='");
					journeyHtml.push(item.id);
					journeyHtml.push("'>");
					journeyHtml.push("Claim");
					journeyHtml.push("</button>");
					journeyHtml.push("</td>");
					journeyHtml.push("</tr>");
				}
				journeyHtml.push("</p>");
				journeyHtml.push("</div>");

				console.log(journeyHtml.join(""));
				$("#accordion").append(journeyHtml.join(""));
				$("#accordion").accordion("refresh");
				
		  });
		  
		});
	}

	$(function() {
		$("#accordion").accordion({
			collapsible : true
		});

		$("button#logon").button().click(function() {

			console.log(this);
			var username = $('#username').val();
			var password = $('#password').val();
			console.log(username + ':' + password);
			$("#loginBox").hide();
			// display();
			getJourneys();
			$("button.claim").click(function() {
				alert("Make the claim " + this.name);
			});

		});

	});
</script>
</head>
<body>

<h1> Late Journeys</h1>
	<div id="loginBox">
		<table>
			<tr>
				<td>Username</td>
				<td><input type="text" id="username" name="username" /></td>
			</tr>
			<tr>
				<td>Password</td>
				<td><input type="password" id="password" name="password" /></td>
			</tr>
			<tr>
				<td colspan="2">
					<button id="logon">Submit</button>
				</td>
			</tr>
		</table>
	</div>


	<div id="accordion"></div>
</body>
</html>


